// Generated by CoffeeScript 1.3.3
var Browser;

(function(moment) {
  return moment.fn.week = function(week) {
    return +this.format("w");
  };
})(moment);

moment;


(function(_) {
  return _.mixin({
    copy: function(properties) {
      var key, obj, value;
      obj = {};
      for (key in properties) {
        value = properties[key];
        obj[key] = Array.isArray(value) ? value.slice() : value;
      }
      return obj;
    }
  });
})(_);

_;


Math.getRandomInt = function(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
};

Browser = (function() {

  function Browser() {
    this.lUA = navigator.userAgent.toLowerCase();
    this.platform = navigator.platform.toLowerCase();
    this.UA = this.lUA.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/) || [null, 'unknown', 0];
    this.mode = this.UA[1] === 'ie' && document.documentMode;
    this.name = this.UA[1] === 'version' ? this.UA[3] : this.UA[1];
    this.version = this.mode || parseFloat(this.UA[1] === 'opera' && this.UA[4] ? this.UA[4] : this.UA[2]);
    this.Platform = {
      name: this.lUA.match(/ip(?:ad|od|hone)/) ? 'ios' : (this.lUA.match(/(?:webos|android)/) || this.platform.match(/mac|win|linux/) || ['other'])[0]
    };
    this.Features = {
      xpath: !!document.evaluate,
      air: !!window.runtime,
      query: !!document.querySelector,
      json: !!window.JSON
    };
    this.flag = (function() {
      if (this.name === 'unknown') {
        switch (this.Platform.name) {
          case 'ios':
            return '-webkit-';
          case 'android':
            return '-webkit-';
          case 'webos':
            return '-webkit-';
        }
      } else {
        switch (this.name) {
          case 'chrome':
            return '-webkit-';
          case 'safari':
            return '-webkit-';
          case 'firefox':
            return '-moz-';
          case 'ie':
            return '-ms-';
          case 'opera':
            return '-o-';
          default:
            return '';
        }
      }
    }).call(this);
  }

  return Browser;

})();

$(function() {
  var song;
  window.browser = new Browser();
  window.ogHeight = window.innerHeight;
  window.platform = browser.Platform.name;
  window.mobile = platform === 'ios' || platform === 'android' ? true : false;
  window.loops = new Loops();
  window.loopView = new LoopView({
    collection: loops
  });
  window.graph = new Graph({
    view: loopView
  });
  window.loopsView = new LoopsView({
    collection: loops,
    subView: loopView
  });
  window.session = new Session('loopsView', 'loopView');
  if (window.navigator.standalone === false) {
    $(document.body).addClass('to-install');
  }
  song = session.newSong();
  $('#music').attr('href', music[song]);
  return $(document.body).addClass('show');
});
